# 🎮 Tag Game – 「鬼ごっこ」

![ゲーム画面サンプル](https://github.com/user-attachments/assets/ebbbe98e-2f22-42e6-b749-27eb8bd10e4c)


ブラウザ＋ Node.js だけで遊べるリアルタイム鬼ごっこです。30 秒の制限時間内に **鬼😈** が誰かにタッチできるか、**逃げ😀 / 😎** 側が逃げ切るかで勝敗が決まります。

---

## 📁 ディレクトリ構成

```
tag-game/
├── infra/            # Terraform (AWS)
│   └── main.tf
├── public/           # クライアント UI
│   └── index.html
├── src/              # サーバーサイド
│   └── server.js
├── package.json
└── .gitignore
```

---

## 🚀 ローカル実行

```bash
# 1. 取得
git clone https://github.com/<your-github>/tag-game.git
cd tag-game

# 2. 依存インストール
npm install

# 3. 起動
npm start

# 4. ブラウザ
http://localhost:3000
```

---

## 🌐 AWS デプロイ

Terraform の `user_data` で **リポジトリが存在する場合は `git pull`**、無ければ `clone` する仕組みを導入しています。コード修正後は `terraform apply` だけで最新バージョンが EC2 に展開されます。

```bash
cd infra
terraform init
terraform apply -auto-approve -var="key_name=<EC2キーペア名>"
```

**ポイント**

* EC2 は Amazon Linux 2023 + Node.js 18。ポート 3000 を開放。
* ボット含め同時接続 10〜20 名程度なら t3.micro で稼働テスト済み。

---

## 🎮 ルール & 操作

| 要素            | 詳細                                                   |
| ------------- | ---------------------------------------------------- |
| **鬼😈**       | 30 秒以内に誰かをタッチできれば勝ち。<br>他プレイヤーに接触すると鬼が交代し、タイマーがリセット。 |
| **逃げ😀 / 😎** | 30 秒間タッチされなければ勝ち。<br>1 秒ごとにスコア +1。自機 😎 は金色リングで表示。   |
| **障害物**       | 灰色ブロックは通行不可。ボットも回避して移動。                              |
| **操作キー**      | ← ↑ ↓ → で移動。スクロールやカーソル移動は抑制済み。                       |
| **常駐ボット**     | プレイヤーが 0 人でも即遊べる。接続人数が増えてもボットは残り、常に 1 体。             |

---

## 🛠 カスタマイズガイド

| 目的          | 変更箇所                                           |
| ----------- | ---------------------------------------------- |
| ラウンド時間変更    | `src/server.js` : `ROUND_MS` を編集。              |
| 障害物追加       | `OBSTACLES` 配列に `{x,y,w,h}` を追加。               |
| ボット挙動       | `BOT_TICK`, `SPEED` を調整。追跡ロジックは setInterval 内。 |
| プレイヤー最大数テスト | `t3.small` 以上に変更し、大量接続で負荷計測。                   |


---

## 🆕 主なアップデート（2025-07-06）

| 変更点             | 概要                                    |
| --------------- | ------------------------------------- |
| **30 秒ラウンド**    | 残り時間が中央上にカウントダウン表示。30 秒逃げ切れば逃げ側勝利。    |
| **障害物ブロック**     | 当たり判定付き灰色ブロックを4つ配置。鬼・逃げとも通り抜け不可。      |
| **常駐ボット**       | プレイヤーが 0 人でも遊べる。鬼なら最短距離で追跡、逃げなら鬼から離脱。 |
| **滑らか操作**       | キー押下状態を 60 fps で送信し、ラグ無し操作を実現。        |
| **ゴーストプレイヤー排除** | 同一ブラウザ多重接続の残像バグを解消。                   |
| **マルチプレイ安定**    | 異なる IP / 同じ LAN でも同時参加可能。             |
| **役割インストラクション** | 画面上部に「▶ 鬼から逃げろ！◀」「▶ タッチしよう！◀」を大きく表示。  |

---

## 📜 ライセンス

MIT License
